<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ† DeVe Modern Tavla TurnuvasÄ±</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="loading">â³ YÃ¼kleniyor...</div>

<div class="container">
    <div class="header">
        <h1>
            <div class="logo"><img src="logo.png" alt="DeVe Logo"></div>
            DeVe Modern Tavla TurnuvasÄ±
        </h1>
        <p>
            <span class="live-indicator"></span>
            CanlÄ± SÄ±ralama
        </p>
    </div>

    <div class="tab-content active" style="padding: 40px;">
        <h2 style="text-align: center; margin-bottom: 30px;">ğŸ¥‡ PODYUM ğŸ¥‡</h2>
        
        <div class="podium" id="podium">
            <div class="podium-place podium-2">
                <div class="podium-rank">2</div>
                <div class="podium-name" id="second-name">-</div>
            </div>
            <div class="podium-place podium-1">
                <div class="podium-rank">1</div>
                <div class="podium-name" id="first-name">-</div>
            </div>
            <div class="podium-place podium-3">
                <div class="podium-rank">3</div>
                <div class="podium-name" id="third-name">-</div>
            </div>
        </div>

        <div style="text-align: center; margin-top: 50px;">
            <button id="playerSelectBtn" class="btn" style="margin-bottom: 20px;">ğŸ‘¤ KatÄ±lÄ±mcÄ± SeÃ§</button>
        </div>

        <div id="playerSelectModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; padding: 20px; box-sizing: border-box;">
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 15px; max-width: 400px; width: 100%; max-height: 80vh; overflow-y: auto;">
                <h3 style="text-align: center; margin-bottom: 20px; font-size: 1.2em;">KatÄ±lÄ±mcÄ± SeÃ§in</h3>
                <div id="playerList"></div>
                <button onclick="closePlayerModal()" style="margin-top: 15px; width: 100%; padding: 12px; background: #8B4513; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">Kapat</button>
            </div>
        </div>

        <h2 style="text-align: center; margin-top: 50px; margin-bottom: 20px;">ğŸ² SKOR TABLOSU</h2>
        <div style="max-width: 800px; margin: 0 auto;">
            <table id="fullLeaderboard" style="width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                <thead>
                    <tr style="background: #8B4513; color: white;">
                        <th style="padding: 12px; text-align: center;">SÄ±ra</th>
                        <th style="padding: 12px; text-align: left;">Oyuncu</th>
                        <th style="padding: 12px; text-align: center;">Oynanan</th>
                        <th style="padding: 12px; text-align: center;">Puan</th>
                        <th style="padding: 12px; text-align: center;">Ort. SÃ¼re</th>
                        <th style="padding: 12px; text-align: center;">Averaj</th>
                    </tr>
                </thead>
                <tbody id="fullLeaderboardBody">
                </tbody>
            </table>
        </div>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyBWtAjBA2cBNZdMnR9s88uyV6h61RFMmw0",
    authDomain: "deve-3b098.firebaseapp.com",
    databaseURL: "https://deve-3b098-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "deve-3b098",
    storageBucket: "deve-3b098.firebasestorage.app",
    messagingSenderId: "709312232350",
    appId: "1:709312232350:web:0428b59946fa7ca102348f"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
let players = [];
let matches = [];
const dbRef = ref(db, 'turnuva');

document.getElementById('loading').style.display = 'block';

onValue(dbRef, (snapshot) => {
    document.getElementById('loading').style.display = 'none';
    if (snapshot.exists()) {
        const data = snapshot.val();
        players = data.players || [];
        matches = data.matches || [];
        renderPodium();
        renderFullLeaderboard();
    }
});

document.getElementById('playerSelectBtn').onclick = () => {
    document.getElementById('playerSelectModal').style.display = 'block';
    renderPlayerList();
};

window.closePlayerModal = () => {
    document.getElementById('playerSelectModal').style.display = 'none';
};

window.selectPlayer = (playerName) => {
    closePlayerModal();
    window.open(`player-stats.html?player=${encodeURIComponent(playerName)}`, '_blank', 'width=1000,height=700,scrollbars=yes,resizable=yes');
};

function renderPlayerList() {
    const list = document.getElementById('playerList');
    list.innerHTML = '';
    players.forEach(player => {
        list.innerHTML += `
            <div onclick="selectPlayer('${player.name}')" style="padding: 10px; margin: 5px 0; background: #F5DEB3; border-radius: 8px; cursor: pointer; text-align: center; transition: background 0.2s;" onmouseover="this.style.background='#DEB887'" onmouseout="this.style.background='#F5DEB3'">
                ${player.name}
            </div>
        `;
    });
}

function renderPodium() {
    players.sort((a, b) => {
        if (b.points !== a.points) return b.points - a.points;
        const avgA = a.played > 0 ? a.totalTime / a.played : 0;
        const avgB = b.played > 0 ? b.totalTime / b.played : 0;
        if (avgA !== avgB) return avgA - avgB;
        if (b.average !== a.average) return b.average - a.average;
        return a.totalTime - b.totalTime;
    });
    document.getElementById('first-name').textContent = players[0]?.name || '-';
    document.getElementById('second-name').textContent = players[1]?.name || '-';
    document.getElementById('third-name').textContent = players[2]?.name || '-';
}

function renderFullLeaderboard() {
    const tbody = document.getElementById('fullLeaderboardBody');
    tbody.innerHTML = '';
    if (players.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px; color: #999;">HenÃ¼z oyuncu yok</td></tr>';
        return;
    }
    players.forEach((p, index) => {
        const rowClass = index === 0 ? 'background: #FFD700;' : index === 1 ? 'background: #C0C0C0;' : index === 2 ? 'background: #CD7F32;' : '';
        const avgTime = p.played > 0 ? (p.totalTime / p.played).toFixed(1) : '0';
        tbody.innerHTML += `
            <tr style="border-bottom: 1px solid #eee; ${rowClass}">
                <td style="padding: 12px; text-align: center; font-weight: bold;">${index + 1}</td>
                <td style="padding: 12px; font-weight: bold;">${p.name}</td>
                <td style="padding: 12px; text-align: center;">${p.played}</td>
                <td style="padding: 12px; text-align: center; font-weight: bold;">${p.points}</td>
                <td style="padding: 12px; text-align: center;">${avgTime}dk</td>
                <td style="padding: 12px; text-align: center;">${p.average > 0 ? '+' + p.average : p.average}</td>
            </tr>
        `;
    });
}
</script>
</body>
</html>
